<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANDBOX GRAMEDYA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.25.0/axios.min.js" integrity="sha512-/Q6t3CASm04EliI1QyIDAA/nDo9R8FQ/BULoUFyN4n/BDdyIxeH7u++Z+eobdmr11gG5D/6nPFyDlnisDwhpYA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <span class="navbar-brand mb-0 h1">GRAMEDYA</span>
    </nav>
    <div class="container">
        <div class="d-flex justify-content-between">
            <h4>List Data Buku</h4>
            <button class="btn btn-primary" data-toggle="modal" data-target="#modalTambah">Tambah Data</button>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nama</th>
                    <th scope="col">Kategori</th>
                    <th scope="col">Aksi</th>
                </tr>
            </thead>
            <tbody id="list-buku">

            </tbody>
        </table>
    </div>

    <div class="modal fade" id="modalTambah" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Formulir Tambah</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Nama Buku</label>
                        <input type="text" class="form-control" id="name" placeholder="Buku Negara">
                    </div>
                    <div class="form-group">
                        <label for="kategori">Kategori</label>
                        <select class="form-control" id="kategori">
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="createBuku()">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BUKU = "https://mybook-order.herokuapp.com/books";
        const API_KATEGORI = "https://mybook-order.herokuapp.com/books/type"

        const getAllKategori = async () => {
            try {
                const request = await axios.get(API_KATEGORI);
                const data = request.data.data
                let listHtml = ""
                data.forEach(kategori => {
                    listHtml += `<option value="${kategori.id}">${kategori.name}</option>`
                });
                $("#kategori").html(listHtml)
            } catch (error) {
                console.log(error)
            }
        }
        const getAllBuku = async () => {
            try {
                const request = await axios.get(API_BUKU);
                const data = request.data.data;
                let listHtml = "";
                data.forEach((book, i) => {
                    listHtml += `
                                    <tr>
                                    <th scope="row">${i + 1}</th>
                                    <td>${book.name}</td>
                                    <td>${book.type_book.name}</td>
                                    <td> <button type="button" class="btn btn-danger" onclick="deleteBuku(${book.id})">Hapus</button> </td>
                                </tr>`
                });
                $("#list-buku").html(listHtml);
            } catch (error) {
                console.log(error);
            }
        }
        const createBuku = async () => {
            try {
                const payload = {
                    name: $("#name").val(),
                    type_books_id: $("#kategori").val()
                }
                const request = await axios.post(API_BUKU, payload);
                $("#modalTambah").modal("hide");
                $("#name").val("");
                $("#kategori").val("");
                Swal.fire({
                    icon: 'success',
                    title: 'Success!!!',
                    text: request.data.message,
                })
                getAllBuku();
            } catch (error) {
                console.log(error);
            }
        }

        const deleteBuku = async (id) => {
            try {
                const request = await axios.delete(API_BUKU, {
                    data: {
                        id: id
                    }
                });
                Swal.fire({
                    icon: 'success',
                    title: 'Success!!!',
                    text: request.data.message,
                })
                getAllBuku();
            } catch (error) {
                console.log(error);
            }
        }
        getAllBuku();
        getAllKategori();
    </script>

</body>

</html>